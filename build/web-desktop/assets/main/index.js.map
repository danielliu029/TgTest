{"version":3,"sources":["../file:/Users/liuyingbin/code/cocos/TgTest/assets/scripts/file:/Users/liuyingbin/code/cocos/TgTest/assets/scripts/GameManager.ts","../file:/Users/liuyingbin/code/cocos/TgTest/assets/scripts/file:/Users/liuyingbin/code/cocos/TgTest/assets/scripts/ResolutionAdjuster.ts","../file:/Users/liuyingbin/code/cocos/TgTest/assets/cocos-telegram-miniapps/scripts/file:/Users/liuyingbin/code/cocos/TgTest/assets/cocos-telegram-miniapps/scripts/telegram-web.ts"],"names":["ccclass","property","_decorator","GameManager","_dec","_dec2","Label","_dec3","_dec4","_dec5","_class","_class2","Component","constructor","arguments","_initializerDefineProperty","_descriptor","_descriptor2","_descriptor3","_descriptor4","_isConnected","_webAppInitData","onLoad","console","info","TelegramWebApp","Instance","init","then","res","success","getTelegramWebAppInitData","user","idLbl","string","id","nameLbl","username","start","update","deltaTime","onConnect","connectLbl","onShare","share","_applyDecoratedDescriptor","prototype","configurable","enumerable","writable","initializer","_RF","pop","ResolutionAdjuster","CCInteger","_dec6","CCBoolean","_descriptor5","isAutoFit","autoFit","window","addEventListener","bind","designSize","View","instance","getDesignResolutionSize","viewPortRect","getViewportRect","setOrientation","log","rateR","height","width","rateV","Math","abs","size","setDesignResolutionSize","fixedWidthDesignWidth","fixedWidthDesignHeight","ResolutionPolicy","FIXED_WIDTH","fixedHeightDesignWidth","fixedHeightDesignHeight","FIXED_HEIGHT","tgLoadPromise","Promise","resolve","reject","sys","platform","Platform","MOBILE_BROWSER","DESKTOP_BROWSER","script","document","createElement","src","async","onload","intervalId","setInterval","Telegram","WebApp","clearInterval","onerror","Error","head","appendChild","_tgWebAppJS","_instance","openTelegramLink","url","error","openLink","options","text","shareUrl","encodeURIComponent","shareToStory","media_url","shareText","widget_link_url","widget_link_name","widget_link","name","getTelegramWebApp","initDataUnsafe","getTelegramUser","getTelegramInitData","initData","openInvoice","callback","alert","message","showAlert"],"mappings":"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","file":"all.js","sourcesContent":["import { _decorator, Component, Label, Button, Node } from 'cc';\nimport { TelegramWebApp, WebAppInitData } from '../cocos-telegram-miniapps/scripts/telegram-web';\n\nconst { ccclass, property } = _decorator;\n\n@ccclass('GameManager')\nexport class GameManager extends Component {\n    @property(Label)\n    idLbl: Label = null;\n\n    @property(Label)\n    nameLbl: Label = null;\n\n    @property(Label)\n    addressLbl: Label = null;\n\n    @property(Label)\n    connectLbl: Label = null;\n\n    private _isConnected: boolean = false;\n    private _webAppInitData: WebAppInitData = null;\n\n    protected onLoad() {\n        console.info(\"onLoad\");\n        TelegramWebApp.Instance.init().then(res => {\n            console.info(\"telegram web app init : \", res.success);\n            this._webAppInitData = TelegramWebApp.Instance.getTelegramWebAppInitData();\n            console.info(this._webAppInitData);\n            console.info(this._webAppInitData.user);\n            if (this._webAppInitData && this._webAppInitData.user) {\n                this.idLbl.string = \"Id: \" + this._webAppInitData.user.id; //telegram用户唯一id，可以用于tg小游戏登录\n                this.nameLbl.string = \"UserName: \" + this._webAppInitData.user.username;\n            } \n        });\n    }\n\n    start() {\n\n    }\n\n    update(deltaTime: number) {\n\n    }\n\n    public onConnect() {\n        this._isConnected = !this._isConnected;\n        console.info(\"_isConnected: \" + this._isConnected);\n        this.connectLbl.string = this._isConnected ? \"Connected\" : \"Connect\";\n    }\n\n    public onShare() {\n        console.info(\"share \");\n        TelegramWebApp.Instance.share(\"https://t.me/MyTestGame029Bot/TgTest\", \"Invite you to play a very interesting game\");\n    }\n}\n\n","import { _decorator, Canvas, CCBoolean, CCInteger, Component, Node, ResolutionPolicy, View } from 'cc';\nimport { LogManager } from '../../scripts/framework/common/LogManager';\nconst { ccclass, property } = _decorator;\n\n@ccclass('ResolutionAdjuster')\nexport class ResolutionAdjuster extends Component {\n    @property(CCInteger)\n    fixedWidthDesignWidth: number = 1280;\n    @property(CCInteger)\n    fixedWidthDesignHeight: number = 720;\n\n    @property(CCInteger)\n    fixedHeightDesignWidth: number = 720;\n    @property(CCInteger)\n    fixedHeightDesignHeight: number = 1280;\n\n    @property(CCBoolean)\n    isAutoFit: boolean = true;\n\n    protected onLoad(): void {\n        if (this.isAutoFit)\n        {\n            this.autoFit();\n            window.addEventListener('resize', this.autoFit.bind(this));\n            // Screen.on('orientation-change', this.autoFit.bind(this));\n        }\n    }\n\n    protected start(): void {\n        if (this.isAutoFit)\n        {\n            this.autoFit();\n        }\n    }\n\n    private autoFit(): void {\n\n        let designSize = View.instance.getDesignResolutionSize();\n        // console.log(`desginSize = ${designSize}`);\n\n        // let visibleSize = View.instance.getVisibleSize();\n        // console.log(`visibleSize = ${visibleSize}`);\n\n        let viewPortRect = View.instance.getViewportRect();\n        View.instance.setOrientation\n        console.log(`viewPortRect = ${viewPortRect}`);\n        \n        let rateR = designSize.height / designSize.width;\n        let rateV = Math.abs(viewPortRect.size.height) / Math.abs(viewPortRect.size.width);\n        \n        // let rp = ResolutionPolicy.FIXED_HEIGHT;\n        // if (rateV < 1.0)\n        // {\n        //     rp = ResolutionPolicy.FIXED_WIDTH;\n        // }\n\n        console.log(`rateV = ${rateV}`)\n        if (rateV < 1.0)\n        {\n            View.instance.setDesignResolutionSize(this.fixedWidthDesignWidth, this.fixedWidthDesignHeight, ResolutionPolicy.FIXED_WIDTH);\n        }\n        else\n        {\n            View.instance.setDesignResolutionSize(this.fixedHeightDesignWidth, this.fixedHeightDesignHeight, ResolutionPolicy.FIXED_HEIGHT);\n        }\n    }\n}\n\n\n","import { _decorator, sys } from 'cc';\nconst { ccclass, property } = _decorator;\n\n\nconst tgLoadPromise = new Promise<any>((resolve, reject) => {\n    if (sys.platform === sys.Platform.MOBILE_BROWSER || sys.platform === sys.Platform.DESKTOP_BROWSER) {\n        const script = document.createElement(\"script\");\n        script.src = \"https://telegram.org/js/telegram-web-app.js\";\n        script.async = true;\n        script.onload = () => {\n            const intervalId = setInterval(() => {\n                if ((window as any).Telegram && (window as any).Telegram.WebApp) {\n                    resolve((window as any).Telegram.WebApp);\n                    clearInterval(intervalId);\n                }\n            }, 100);\n        };\n        script.onerror = () => reject(new Error(\"Unable to load TelegramWebApp SDK, please check logs.\"));\n        document.head.appendChild(script);\n    }\n});\n\nexport interface WebAppUser {\n    id: number;\n    is_bot: boolean;\n    first_name: string;\n    last_name?: string;\n    username?: string;\n    language_code?: string;\n    is_premium?: boolean;\n    added_to_attachment_menu?: boolean;\n    allows_write_to_pm?: boolean;\n    photo_url?: string;\n}\nexport interface WebAppChat {\n    id: number;\n    type: 'private' | 'group' | 'supergroup' | 'channel';\n    title: string;\n    username?: string;\n    photo_url?: string;\n}\nexport interface WebAppInitData {\n    query_id?: string;\n    user?: WebAppUser;\n    receiver?: WebAppUser;\n    chat?: WebAppChat;\n    chat_type?: 'private' | 'group' | 'supergroup' | 'channel';\n    chat_instance?: string;\n    start_param?: string;\n    can_send_after?: number;\n    auth_data: number;\n    hash: string;\n}\n\n@ccclass('TelegramWebApp')\nexport class TelegramWebApp {\n    private static _instance: TelegramWebApp;\n    private constructor() {\n\n    }\n    public static get Instance(): TelegramWebApp {\n        if (!TelegramWebApp._instance) {\n            TelegramWebApp._instance = new TelegramWebApp();\n        }\n        return TelegramWebApp._instance;\n    }\n\n    private _tgWebAppJS: any = null;\n    public async init(): Promise<{ success: boolean }> {\n        this._tgWebAppJS = await tgLoadPromise;\n\n        if (this._tgWebAppJS) {\n            return Promise.resolve({ success: true });\n        } else {\n            return Promise.resolve({ success: false });\n        }\n    }\n\n    public openTelegramLink(url: string) {\n        if (!this._tgWebAppJS) {\n            console.error(\"telegram web app is not inited!\");\n            return;\n        }\n        this._tgWebAppJS.openTelegramLink(url);\n    }\n\n    public openLink(url: string, options: any = {}) {\n        if (!this._tgWebAppJS) {\n            console.error(\"telegram web app is not inited!\");\n            return;\n        }\n        this._tgWebAppJS.openLink(url, options);\n    }\n\n    public share(url: string, text?: string) {\n        const shareUrl = 'https://t.me/share/url?url=' + encodeURIComponent(url) + '&text=' + encodeURIComponent(text || '');\n        this.openTelegramLink(shareUrl);\n    }\n\n    public shareToStory(media_url: string, shareText?: string, widget_link_url?: string, widget_link_name?: string) {\n        if (!this._tgWebAppJS) {\n            console.error(\"telegram web app is not inited!\");\n            return;\n        }\n        const widget_link = {\n            text: shareText,\n            widget_link: {\n                url: widget_link_url,\n                name: widget_link_name,\n            },\n        };\n        this._tgWebAppJS.shareToStory(media_url, widget_link);\n    }\n\n    public getTelegramWebApp() {\n        return this._tgWebAppJS;\n    }\n\n    public getTelegramWebAppInitData(): WebAppInitData {\n        if (!this._tgWebAppJS) {\n            console.error(\"telegram web app is not inited!\");\n            return null;\n        }\n        return this._tgWebAppJS.initDataUnsafe;\n    }\n\n\n    public getTelegramUser(): WebAppUser {\n        if (!this._tgWebAppJS) {\n            console.error(\"telegram web app is not inited!\");\n            return null;\n        }\n        return this._tgWebAppJS.initDataUnsafe.user;\n    }\n\n    public getTelegramInitData(): string {\n        if (!this._tgWebAppJS) {\n            console.error(\"telegram web app is not inited!\");\n            return null;\n        }\n        return this._tgWebAppJS.initData;\n    }\n\n    public openInvoice(url: string, callback: any) {\n        if (!this._tgWebAppJS) {\n            console.error(\"telegram web app is not inited!\");\n            return null;\n        }\n        this._tgWebAppJS.openInvoice(url, callback);\n    }\n\n    public alert(message: string) {\n        this._tgWebAppJS.showAlert(message);\n    }\n}\n\n\n"]}