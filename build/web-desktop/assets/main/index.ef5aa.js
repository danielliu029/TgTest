System.register("chunks:///_virtual/GameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./telegram-web.ts","./index.ts","./HttpClient.ts"],(function(t){var n,e,i,s,o,a,r,l,c,h,u;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.initializerDefineProperty},function(t){i=t.cclegacy,s=t.Label,o=t.Button,a=t._decorator,r=t.Component},function(t){l=t.TelegramWebApp},function(t){c=t.TonConnectUI,h=t.Address},function(t){u=t.HttpClient}],execute:function(){var d,_,g,p,b,f,m,w,I,L,y,C,U,v,T,S,W,k,B,z;i._RF.push({},"117edbO4YZJoriXQWLvebhl","GameManager",void 0);const{ccclass:D,property:M}=a;t("GameManager",(d=D("GameManager"),_=M(s),g=M(s),p=M(s),b=M(s),f=M(s),m=M(s),w=M(o),I=M(o),d(((z=class t extends r{constructor(){super(...arguments),e(this,"idLbl",C,this),e(this,"nameLbl",U,this),e(this,"addressLbl",v,this),e(this,"pointsLbl",T,this),e(this,"connectLbl",S,this),e(this,"debugInfo",W,this),e(this,"connectButton",k,this),e(this,"danceEndButton",B,this),this.connectUI=null,this._base_url=t._local_host?"http://127.0.0.1:5000":"https://alpha.audiera.fi",this._login_path="/api/auth/telegram",this._test_login_path="/api/test/telegram",this._bind_ton_wallet_path="/api/bindTonWallet",this._unbind_ton_wallet_path="/api/unbindTonWallet",this._dance_end_path="/api/danceEnd",this._user=null,this._token=""}onLoad(){console.info("onLoad"),t._test_login?(this.testLogin(),this.connectButton.enabled=!1):(this.connectButton.enabled=!0,this.initTonConnect(),l.Instance.init().then((t=>{console.info("telegram web app init : ",t.success),console.info("Init Data: "+decodeURIComponent(l.Instance.getTelegramInitData())),this.tgLogin(l.Instance.getTelegramInitData())})))}start(){}update(t){}onConnect(){this.isConnected(!0)?this.doDisconnect():this.connectUI.openModal()}onDanceEnd(){this.danceEnd(200)}onShare(){console.info("share "),l.Instance.share("https://t.me/MyTestGame029Bot/TgTest","Invite you to play a very interesting game")}initTonConnect(){this.connectUI=new c({manifestUrl:"https://ton-connect.github.io/demo-dapp-with-wallet/tonconnect-manifest.json"}),this.connectUI.onModalStateChange((t=>{console.log("model state changed! : ",t),this.updateConnect()})),this.connectUI.onStatusChange((t=>{console.log("wallet info status changed : ",t),this.updateConnect()}))}isConnected(t){return this.connectUI?!(!t||null==this._user||""==this._user.ton_wallet)||this.connectUI.connected:(console.error("ton ui not inited!"),!1)}async doDisconnect(){this.connectUI.connected?this.connectUI.disconnect():(await this.unbindWallet(),this._user.ton_wallet="",this.addressLbl.string="Address: ",this.connectLbl.string="Connect")}async updateConnect(){if(this.isConnected(!1)){var t=h.parseRaw(this.connectUI.account.address).toString({testOnly:!1,bounceable:!1});this._user.ton_wallet=await this.bindTonWallet(t),this.addressLbl.string="Address: "+this._user.ton_wallet,this.connectLbl.string="Connected"}else await this.unbindWallet(),this._user.ton_wallet="",this.addressLbl.string="Address: ",this.connectLbl.string="Connect"}setUserInfo(t){this._user=t.user,this._token=t.token,this.idLbl.string="id: "+this._user.tg_id.toString(),""!=this._user.username?this.nameLbl.string="name: "+this._user.username:this.nameLbl.string="name: "+this._user.first_name+" "+this._user.last_name,this.addressLbl.string="Address: "+this._user.ton_wallet,this.connectLbl.string=this.isConnected(!0)?"Connected":"Connect",this.pointsLbl.string="Points: "+this._user.points.toString()}async testLogin(){try{var t="user="+encodeURIComponent('{"id":1,"first_name":"yingbin","last_name":"liu","username":"daniel029"}')+"&auth_date=1&hash=2&signature=3";console.info(t);var n=await u.post(this._base_url,this._test_login_path,"application/x-www-form-urlencoded",t);this.setUserInfo(n),this.debugInfo.string=""}catch(t){console.error(t)}}async tgLogin(t){try{console.info("tg login: ",t);var n=await u.post(this._base_url,this._login_path,"application/x-www-form-urlencoded",t);this.setUserInfo(n),this.debugInfo.string=""}catch(t){console.error(t),this.debugInfo.string="error: "+t.toString()}}async bindTonWallet(t){try{if(""==this._token)return"";console.info("bindWallet: ",t);var n={wallet:t},e=await u.post(this._base_url,this._bind_ton_wallet_path,"application/json",n,this._token);return this.debugInfo.string="",e.wallet}catch(t){console.error(t),this.debugInfo.string="error: "+t.toString()}}async unbindWallet(){try{if(""==this._token)return;console.info("unBindWallet"),await u.post(this._base_url,this._unbind_ton_wallet_path,"application/json",{},this._token),this.debugInfo.string=""}catch(t){console.error(t),this.debugInfo.string="error: "+t.toString()}}async danceEnd(t){try{if(""==this._token)return 0;console.info("danceEnd: ",t);var n={points:t},e=await u.post(this._base_url,this._dance_end_path,"application/json",n,this._token);this._user.points=e.points,this.pointsLbl.string="Points: "+this._user.points.toString(),this.debugInfo.string=""}catch(t){console.error(t),this.debugInfo.string="error: "+t.toString()}}})._local_host=!1,z._test_login=!1,C=n((y=z).prototype,"idLbl",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=n(y.prototype,"nameLbl",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=n(y.prototype,"addressLbl",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=n(y.prototype,"pointsLbl",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=n(y.prototype,"connectLbl",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=n(y.prototype,"debugInfo",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=n(y.prototype,"connectButton",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=n(y.prototype,"danceEndButton",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=y))||L));i._RF.pop()}}}));

System.register("chunks:///_virtual/HttpClient.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"22ff5UbR0NNAKksBaoUPD1t","HttpClient",void 0);class r{static async request(t,e){try{const r=await fetch(t,e);if(!r.ok)throw new Error(`请求失败: ${r.status} - ${r.statusText}`);return await r.json()}catch(t){throw console.error("网络请求错误:",t),t}}static async get(t,e,n,s,a){const o=new URL(e,t);s&&s.forEach((t=>{let[e,r]=t;o.searchParams.append(e,r)}));var c={"Content-Type":n};return a&&(c.Authorization=`Bearer ${a}`),r.request(o,{method:"GET",headers:c})}static async post(t,e,n,s,a){const o=new URL(e,t);var c={"Content-Type":n};return a&&(c.Authorization=`Bearer ${a}`),r.request(o,{method:"POST",headers:c,body:"application/json"==n?JSON.stringify(s):s})}}t("HttpClient",r),e._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./telegram-web.ts","./GameManager.ts","./HttpClient.ts","./ResolutionAdjuster.ts"],(function(){return{setters:[null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/ResolutionAdjuster.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(i){var t,e,n,s,o,r,h,u,a;return{setters:[function(i){t=i.applyDecoratedDescriptor,e=i.initializerDefineProperty},function(i){n=i.cclegacy,s=i.CCInteger,o=i.CCBoolean,r=i._decorator,h=i.Component,u=i.View,a=i.ResolutionPolicy}],execute:function(){var l,g,c,d,f,p,D,b,H,x,W,w,z;n._RF.push({},"b7cf84Lo3lKQaTeZjg7KYPu","ResolutionAdjuster",void 0);const{ccclass:F,property:R}=r;i("ResolutionAdjuster",(l=F("ResolutionAdjuster"),g=R(s),c=R(s),d=R(s),f=R(s),p=R(o),l((H=t((b=class extends h{constructor(){super(...arguments),e(this,"fixedWidthDesignWidth",H,this),e(this,"fixedWidthDesignHeight",x,this),e(this,"fixedHeightDesignWidth",W,this),e(this,"fixedHeightDesignHeight",w,this),e(this,"isAutoFit",z,this)}onLoad(){this.isAutoFit&&(this.autoFit(),window.addEventListener("resize",this.autoFit.bind(this)))}start(){this.isAutoFit&&this.autoFit()}autoFit(){let i=u.instance.getDesignResolutionSize(),t=u.instance.getViewportRect();u.instance.setOrientation,console.log(`viewPortRect = ${t}`);i.height,i.width;let e=Math.abs(t.size.height)/Math.abs(t.size.width);console.log(`rateV = ${e}`),e<1?u.instance.setDesignResolutionSize(this.fixedWidthDesignWidth,this.fixedWidthDesignHeight,a.FIXED_WIDTH):u.instance.setDesignResolutionSize(this.fixedHeightDesignWidth,this.fixedHeightDesignHeight,a.FIXED_HEIGHT)}}).prototype,"fixedWidthDesignWidth",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1280}}),x=t(b.prototype,"fixedWidthDesignHeight",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 720}}),W=t(b.prototype,"fixedHeightDesignWidth",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 720}}),w=t(b.prototype,"fixedHeightDesignHeight",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1280}}),z=t(b.prototype,"isAutoFit",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),D=b))||D));n._RF.pop()}}}));

System.register("chunks:///_virtual/telegram-web.ts",["cc"],(function(e){var t,r,n;return{setters:[function(e){t=e.cclegacy,r=e.sys,n=e._decorator}],execute:function(){var p,o;t._RF.push({},"ebfffcpPmpO2Kop7FNww8J8","telegram-web",void 0);const{ccclass:s,property:i}=n,a=new Promise(((e,t)=>{if(r.platform===r.Platform.MOBILE_BROWSER||r.platform===r.Platform.DESKTOP_BROWSER){const r=document.createElement("script");r.src="https://telegram.org/js/telegram-web-app.js",r.async=!0,r.onload=()=>{const t=setInterval((()=>{window.Telegram&&window.Telegram.WebApp&&(e(window.Telegram.WebApp),clearInterval(t))}),100)},r.onerror=()=>t(new Error("Unable to load TelegramWebApp SDK, please check logs.")),document.head.appendChild(r)}}));e("TelegramWebApp",s("TelegramWebApp")(((o=class e{constructor(){this._tgWebAppJS=null}static get Instance(){return e._instance||(e._instance=new e),e._instance}async init(){return this._tgWebAppJS=await a,this._tgWebAppJS?Promise.resolve({success:!0}):Promise.resolve({success:!1})}openTelegramLink(e){this._tgWebAppJS?this._tgWebAppJS.openTelegramLink(e):console.error("telegram web app is not inited!")}openLink(e,t){void 0===t&&(t={}),this._tgWebAppJS?this._tgWebAppJS.openLink(e,t):console.error("telegram web app is not inited!")}share(e,t){const r="https://t.me/share/url?url="+encodeURIComponent(e)+"&text="+encodeURIComponent(t||"");this.openTelegramLink(r)}shareToStory(e,t,r,n){if(!this._tgWebAppJS)return void console.error("telegram web app is not inited!");const p={text:t,widget_link:{url:r,name:n}};this._tgWebAppJS.shareToStory(e,p)}getTelegramWebApp(){return this._tgWebAppJS}getTelegramWebAppInitData(){return this._tgWebAppJS?this._tgWebAppJS.initDataUnsafe:(console.error("telegram web app is not inited!"),null)}getTelegramUser(){return this._tgWebAppJS?this._tgWebAppJS.initDataUnsafe.user:(console.error("telegram web app is not inited!"),null)}getTelegramInitData(){return this._tgWebAppJS?this._tgWebAppJS.initData:(console.error("telegram web app is not inited!"),null)}openInvoice(e,t){if(!this._tgWebAppJS)return console.error("telegram web app is not inited!"),null;this._tgWebAppJS.openInvoice(e,t)}alert(e){this._tgWebAppJS.showAlert(e)}})._instance=void 0,p=o))||p);t._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});
//# sourceMappingURL=index.js.map