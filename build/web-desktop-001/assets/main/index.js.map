{"version":3,"sources":["../file:/Users/liuyingbin/code/cocos/TgTest/assets/scripts/file:/Users/liuyingbin/code/cocos/TgTest/assets/scripts/GameManager.ts","../file:/Users/liuyingbin/code/cocos/TgTest/assets/cocos-telegram-miniapps/scripts/file:/Users/liuyingbin/code/cocos/TgTest/assets/cocos-telegram-miniapps/scripts/telegram-web.ts"],"names":["ccclass","property","_decorator","GameManager","_dec","_dec2","Label","_dec3","_dec4","_dec5","_class","_class2","Component","constructor","arguments","_initializerDefineProperty","_descriptor","_descriptor2","_descriptor3","_descriptor4","_isConnected","_webAppInitData","onLoad","console","info","TelegramWebApp","Instance","init","then","res","success","getTelegramWebAppInitData","user","idLbl","string","id","nameLbl","username","start","update","deltaTime","onConnect","connectLbl","onShare","_applyDecoratedDescriptor","prototype","configurable","enumerable","writable","initializer","_RF","pop","tgLoadPromise","Promise","resolve","reject","sys","platform","Platform","MOBILE_BROWSER","DESKTOP_BROWSER","script","document","createElement","src","async","onload","intervalId","setInterval","window","Telegram","WebApp","clearInterval","onerror","Error","head","appendChild","_tgWebAppJS","_instance","openTelegramLink","url","error","openLink","options","share","text","shareUrl","encodeURIComponent","shareToStory","media_url","shareText","widget_link_url","widget_link_name","widget_link","name","getTelegramWebApp","initDataUnsafe","getTelegramUser","getTelegramInitData","initData","openInvoice","callback","alert","message","showAlert"],"mappings":"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","file":"all.js","sourcesContent":["import { _decorator, Component, Label, Button, Node } from 'cc';\nimport { TelegramWebApp, WebAppInitData } from '../cocos-telegram-miniapps/scripts/telegram-web';\n\nconst { ccclass, property } = _decorator;\n\n@ccclass('GameManager')\nexport class GameManager extends Component {\n    @property(Label)\n    idLbl: Label = null;\n\n    @property(Label)\n    nameLbl: Label = null;\n\n    @property(Label)\n    addressLbl: Label = null;\n\n    @property(Label)\n    connectLbl: Label = null;\n\n    private _isConnected: boolean = false;\n    private _webAppInitData: WebAppInitData = null;\n\n    protected onLoad() {\n        console.info(\"onLoad\");\n        TelegramWebApp.Instance.init().then(res => {\n            console.info(\"telegram web app init : \", res.success);\n            this._webAppInitData = TelegramWebApp.Instance.getTelegramWebAppInitData();\n            console.info(this._webAppInitData);\n            console.info(this._webAppInitData.user);\n            if (this._webAppInitData && this._webAppInitData.user) {\n                this.idLbl.string = \"Id: \" + this._webAppInitData.user.id; //telegram用户唯一id，可以用于tg小游戏登录\n                this.nameLbl.string = \"UserName: \" + this._webAppInitData.user.username;\n            } \n        });\n    }\n\n    start() {\n\n    }\n\n    update(deltaTime: number) {\n\n    }\n\n    public onConnect() {\n        this._isConnected = !this._isConnected;\n        console.info(\"_isConnected: \" + this._isConnected);\n        this.connectLbl.string = this._isConnected ? \"Connected\" : \"Connect\";\n    }\n\n    public onShare() {\n        console.info(\"share\");\n    }\n}\n\n","import { _decorator, sys } from 'cc';\nconst { ccclass, property } = _decorator;\n\n\nconst tgLoadPromise = new Promise<any>((resolve, reject) => {\n    if (sys.platform === sys.Platform.MOBILE_BROWSER || sys.platform === sys.Platform.DESKTOP_BROWSER) {\n        const script = document.createElement(\"script\");\n        script.src = \"https://telegram.org/js/telegram-web-app.js\";\n        script.async = true;\n        script.onload = () => {\n            const intervalId = setInterval(() => {\n                if ((window as any).Telegram && (window as any).Telegram.WebApp) {\n                    resolve((window as any).Telegram.WebApp);\n                    clearInterval(intervalId);\n                }\n            }, 100);\n        };\n        script.onerror = () => reject(new Error(\"Unable to load TelegramWebApp SDK, please check logs.\"));\n        document.head.appendChild(script);\n    }\n});\n\nexport interface WebAppUser {\n    id: number;\n    is_bot: boolean;\n    first_name: string;\n    last_name?: string;\n    username?: string;\n    language_code?: string;\n    is_premium?: boolean;\n    added_to_attachment_menu?: boolean;\n    allows_write_to_pm?: boolean;\n    photo_url?: string;\n}\nexport interface WebAppChat {\n    id: number;\n    type: 'private' | 'group' | 'supergroup' | 'channel';\n    title: string;\n    username?: string;\n    photo_url?: string;\n}\nexport interface WebAppInitData {\n    query_id?: string;\n    user?: WebAppUser;\n    receiver?: WebAppUser;\n    chat?: WebAppChat;\n    chat_type?: 'private' | 'group' | 'supergroup' | 'channel';\n    chat_instance?: string;\n    start_param?: string;\n    can_send_after?: number;\n    auth_data: number;\n    hash: string;\n}\n\n@ccclass('TelegramWebApp')\nexport class TelegramWebApp {\n    private static _instance: TelegramWebApp;\n    private constructor() {\n\n    }\n    public static get Instance(): TelegramWebApp {\n        if (!TelegramWebApp._instance) {\n            TelegramWebApp._instance = new TelegramWebApp();\n        }\n        return TelegramWebApp._instance;\n    }\n\n    private _tgWebAppJS: any = null;\n    public async init(): Promise<{ success: boolean }> {\n        this._tgWebAppJS = await tgLoadPromise;\n\n        if (this._tgWebAppJS) {\n            return Promise.resolve({ success: true });\n        } else {\n            return Promise.resolve({ success: false });\n        }\n    }\n\n    public openTelegramLink(url: string) {\n        if (!this._tgWebAppJS) {\n            console.error(\"telegram web app is not inited!\");\n            return;\n        }\n        this._tgWebAppJS.openTelegramLink(url);\n    }\n\n    public openLink(url: string, options: any = {}) {\n        if (!this._tgWebAppJS) {\n            console.error(\"telegram web app is not inited!\");\n            return;\n        }\n        this._tgWebAppJS.openLink(url, options);\n    }\n\n    public share(url: string, text?: string) {\n        const shareUrl = 'https://t.me/share/url?url=' + encodeURIComponent(url) + '&text=' + encodeURIComponent(text || '');\n        this.openTelegramLink(shareUrl);\n    }\n\n    public shareToStory(media_url: string, shareText?: string, widget_link_url?: string, widget_link_name?: string) {\n        if (!this._tgWebAppJS) {\n            console.error(\"telegram web app is not inited!\");\n            return;\n        }\n        const widget_link = {\n            text: shareText,\n            widget_link: {\n                url: widget_link_url,\n                name: widget_link_name,\n            },\n        };\n        this._tgWebAppJS.shareToStory(media_url, widget_link);\n    }\n\n    public getTelegramWebApp() {\n        return this._tgWebAppJS;\n    }\n\n    public getTelegramWebAppInitData(): WebAppInitData {\n        if (!this._tgWebAppJS) {\n            console.error(\"telegram web app is not inited!\");\n            return null;\n        }\n        return this._tgWebAppJS.initDataUnsafe;\n    }\n\n\n    public getTelegramUser(): WebAppUser {\n        if (!this._tgWebAppJS) {\n            console.error(\"telegram web app is not inited!\");\n            return null;\n        }\n        return this._tgWebAppJS.initDataUnsafe.user;\n    }\n\n    public getTelegramInitData(): string {\n        if (!this._tgWebAppJS) {\n            console.error(\"telegram web app is not inited!\");\n            return null;\n        }\n        return this._tgWebAppJS.initData;\n    }\n\n    public openInvoice(url: string, callback: any) {\n        if (!this._tgWebAppJS) {\n            console.error(\"telegram web app is not inited!\");\n            return null;\n        }\n        this._tgWebAppJS.openInvoice(url, callback);\n    }\n\n    public alert(message: string) {\n        this._tgWebAppJS.showAlert(message);\n    }\n}\n\n\n"]}